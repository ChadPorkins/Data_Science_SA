---
title: "Data science project - Suicidial attacks"
author: "Mr. Jakob Alderson & MR. Tal Bracha"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: architect
    highlight: github
---

```{r, echo= FALSE, message=FALSE}
library(tidyverse)
library(mapview)
library(sf)
library(ggplot2)
library(ggmap)
library(tseries)
library(car)
library(moments)
library(writexl)
library(AID)
```


## inro

why its impotent

## litetature 

dddasdasddddd

dsadsd

## hypothesis

## Suicidal attacks global or middle eastern problem?

```{r}
points = read.csv("attacks.csv")
points = points[!is.na(points$latitude), ]
points = points[!is.na(points$longitude), ]
```

```{r, warning=FALSE}

world <- map_data("world")
   ggplot() +
     geom_map(
       data = world, map = world,
       aes(long, lat, map_id = region),
       color = "black", fill = "lightgray", size = 0.1
     ) +
     geom_point(
       data = points,
       aes(longitude, latitude), color = "blue",
       alpha = 0.7
     ) 
```

Point density:
```{r}
ggplot(points, aes(x = longitude, y = latitude)) + 
     geom_point() + 
     coord_equal() + 
     xlab('longitude') + 
     ylab('latitude') + 
     stat_density2d(aes(fill = ..level..), alpha = 100,
                    geom = "polygon", data = points) + 
     scale_fill_viridis_c() + 
     theme(legend.position = 'none') 
```

The middle east  is the brightest

## Data Cleaning and Normaliry

Before cleanig:

```{r}
attacks = read.csv("attacks.csv")
head(as_tibble(attacks))
```
 
After some data organization:
```{r}
attacks = as_tibble(attacks) %>%
  select(event_id,wounded_low,wounded_high,killed_low,killed_high) %>%
  filter(wounded_low >= 0) %>%
  filter(wounded_high >= 0) %>%
  filter(killed_low >= 0) %>%
  filter(killed_high >= 0) %>%
  mutate(wounded_average = ceiling(((wounded_low + wounded_high)/2) )) %>%
  mutate(killed_average = ceiling(((killed_low + killed_high)/2) )) %>% 
  mutate(casualties = wounded_average + killed_average) %>%
  filter(casualties < 1000) %>%
  select(event_id,wounded_average,killed_average,casualties)
 head(attacks)
```

## normality visualtization 

```{r}
par(mfrow = c(1,3))
hist(attacks$wounded_average, breaks = length(attacks$wounded_average))
hist(attacks$killed_average, breaks = length(attacks$killed_average))
hist(attacks$casualties, breaks = length(attacks$casualties))

```

The data is Poisson distributions, we have a massive possite right skew 

```{r}
par(mfrow = c(1,3))
qqPlot(attacks$wounded_average, id= FALSE)
qqPlot(attacks$killed_average, id= FALSE)
qqPlot(attacks$casualties, id= FALSE)
```



## sqrt data transform 

```{r}
par(mfrow = c(1,3))
hist(sqrt(attacks$wounded_average + 1 ))
hist(sqrt(attacks$killed_average + 1 ))
hist(sqrt(attacks$casualties + 1))

```

## log data transform  

```{r}
par(mfrow = c(1,3))
hist(log10(attacks$wounded_average + 1 ))
hist(log10(attacks$killed_average + 1 ))
hist(log10(attacks$casualties + 1 ))

```

## inverse data transform 
```{r}
par(mfrow = c(1,3))
hist(1/(attacks$wounded_average + 1 ))
hist(1/(attacks$killed_average + 1 ))
hist(1/(attacks$casualties + 1))

```

## log 10 looks like nomal disterbution, but whats the problem?

```{r}
agostino.test(log10(attacks$casualties+1))
```

too many repetitions


```{r}
attacks2 = attacks %>%
  count(casualties, sort = TRUE) %>%
  filter(casualties < 30)


      ggplot(data = attacks2, aes(x=casualties, y=n)) +
  geom_bar(stat="identity", width=0.5)

```

We did our best but you cant transform poisson distribution with low lambda
#https://bookdown.org/ndphillips/YaRrr/regression-on-non-normal-data-with-glm.html

## some corroletion!

```{r}
attackers = read.csv("attackers.csv") 
head( as_tibble(attackers) )
```

## some tidy
```{r}
attackers = attackers %>%
  as_tibble() %>%
  select(event_id,attacker_id,age_time_death,gender,birth_admin0_txt) %>%
  filter(age_time_death > 0) 
  head(attackers)
```

```{r}
male_attackers = attackers %>%
filter(gender == "Male") %>%
inner_join(attacks, by =  "event_id") %>%
select(age_time_death,wounded_average,killed_average,casualties)
head(male_attackers)

```

```{r}
res<-cor.test(male_attackers$age_time_death,male_attackers$wounded_average, method="kendall")
res
```

```{r}
res2<-cor.test(male_attackers$age_time_death,male_attackers$killed_average, method="kendall")
res2
```

```{r}
res3<-cor.test(male_attackers$age_time_death,male_attackers$casualties, method="kendall")
res3
```

```{r}
res4= glm(casualties ~  age_time_death, data = male_attackers , family = "poisson"	)
summary(res4)
```


